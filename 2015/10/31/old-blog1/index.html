<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>RSA加密算法在iOS9下的问题解决方案 | SuuSatoshigi's blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">RSA加密算法在iOS9下的问题解决方案</h1><a id="logo" href="/.">SuuSatoshigi's blog</a><p class="description">It is said that writing 1000 words a day can change my life.</p></div><div id="nav-menu"><a href="/"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">RSA加密算法在iOS9下的问题解决方案</h1><div class="post-meta">2015-10-31 | <span class="categories">分类于<a href="/categories/主攻击技能/"> 主攻击技能</a></span></div><span data-disqus-identifier="2015/10/31/old-blog1/" class="disqus-comment-count"></span><div class="post-content"><p>本人于2015年5月写的可运行的RSA加密解密算法，升级到iOS9之后，到<code>SecItemAdd</code>就crash掉了。<br>打了断点发现SecKeyRef竟然为空，几个月前可不是这样的，只能是iOS9更新了什么。看了一下官方文档：<a href="https://support.apple.com/en-us/HT205212" target="_blank" rel="external">About the security content of iOS 9</a></p>
<blockquote>
<p>CFNetwork SSL<br>Available for: iPhone 4s and later, iPod touch (5th generation) and later, iPad 2 and later<br>Impact: An attacker may be able to decrypt data protected by SSL<br>Description: There are known attacks on the confidentiality of RC4. An attacker could force the use of RC4, even if the server preferred better ciphers, by blocking TLS 1.0 and higher connections until CFNetwork tried SSL 3.0, which only allows RC4. This issue was addressed by removing the fallback to SSL 3.0.</p>
</blockquote>
<p>大概就是说，旧的网络方式被破了，所以换成了SSL 3.0的。SSL 3.0用的是RSA加密，所以，我觉得是苹果认为觉得自己新的连接方式比较安全，不需要双层加密吧。（当然也有可能是苹果的bug，<a href="https://github.com/AArnott/PCLCrypto/issues/29" target="_blank" rel="external">Import of RSA key crashes on iOS9</a>)</p>
<hr>
<p>在<a href="http://weibo.com/u/1794589962" target="_blank" rel="external">@xillkey</a>的启发下想到一个曲折救国的解决方案：</p>
<p>###就是偷偷新建一个web view把加密的算法用javascript执行，曲线救国</p>
<p>首先，在项目里新建一个rsa.html，然后写上以下代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"jsbn.js"</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span><span class="value">src="prng4.js"</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"rng.js"</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"rsa.js"</span> &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="actionscript"></span><br><span class="line">        <span class="keyword">var</span> cipher = <span class="keyword">new</span> RSAKey();</span><br><span class="line">        </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>之后在对应的.m文件下写上：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) UIWebView *web;&#10;&#10;- (void) viewDidLoad&#123;&#10;&#9;_web = [[UIWebView alloc] init];&#10;    NSString *path = [[NSBundle mainBundle] bundlePath];&#10;    NSURL *baseURL = [NSURL fileURLWithPath:path];&#10;    NSString * htmlPath = [[NSBundle mainBundle] pathForResource:@&#34;rsa&#34;&#10;                                                          ofType:@&#34;html&#34;];&#10;    NSString * htmlCont = [NSString stringWithContentsOfFile:htmlPath&#10;                                                    encoding:NSUTF8StringEncoding&#10;                                                       error:nil];&#10;    &#10;    [_web loadHTMLString:htmlCont baseURL:baseURL];&#10;&#125;&#10;&#10;- (void)function:(NSString *)modulus exponent:(NSString *)exponent &#123;       &#10;        [_web stringByEvaluatingJavaScriptFromString:[[NSString alloc] initWithFormat:@&#34;cipher.setPublic(&#39;%@&#39;,&#39;%@&#39;);&#34;,modulus,exponent]];&#10;        NSString *hexStr = [_web stringByEvaluatingJavaScriptFromString:[[NSString alloc] initWithFormat:@&#34;cipher.encrypt(&#39;%@&#39;)&#34;,_passwordTextField.text]];&#10;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>hexStr就是你想要的rsa加密过的密码（或者别的什么东西）</strong>啦～本来理论上可以用c语言根据rsa算法公式写出c语言版本的加密解密文件，后来有小伙伴提醒道苹果时不允许自己写rsa只能用他的2048位，所以突然不爽苹果决定用另一个方案解决，跳过Objective-c。</p>
<p>本解决方案还需要在项目中四个js文件，下载地址：<a href="http://download.csdn.net/detail/u010558548/9229941" target="_blank" rel="external">rsa的js文件</a></p>
<p>感谢js的作者带给我新思路，还有，如果有什么大神路过觉得我这个办法可以有更好的解决方案，非常希望教授经验。</p>
<hr>
<p>在以下网址中可以得到其他的，用正常的处理方案（我觉得用js有点投机取巧了）：<br><a href="https://forums.developer.apple.com/thread/15129" target="_blank" rel="external">https://forums.developer.apple.com/thread/15129</a><br><a href="https://forums.developer.apple.com/message/38361#38361" target="_blank" rel="external">https://forums.developer.apple.com/message/38361#38361</a><br>StCredZero/SCZ-BasicEncodingRules-iOS#6 (comment)<br>具体的解决方案在<br><a href="https://github.com/AArnott/PCLCrypto/issues/29" target="_blank" rel="external">https://github.com/AArnott/PCLCrypto/issues/29</a><br>差不多结束的对话里。</p>
<p>还有：<a href="http://blog.iamzsx.me/show.html?id=155002" target="_blank" rel="external">http://blog.iamzsx.me/show.html?id=155002</a><br>这博客的处理方案经实验验证，也是可以在iOS9上跑通的。</p>
<hr>
<p>最后，这篇文章的原文在这里：<a href="http://blog.csdn.net/suusatoshigi/article/details/49535391" target="_blank" rel="external">my csdn blog</a></p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a href="/2015/11/26/reason/" class="pre"><i class="icon-previous">为什么开始写博客</i></a><a href="/2015/10/30/test-old-blog1/" class="next">app测试篇（一）<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'suusatoshigi';
var disqus_identifier = '2015/10/31/old-blog1/';
var disqus_title = 'RSA加密算法在iOS9下的问题解决方案';
var disqus_url = 'http://suusatoshigi.com/2015/10/31/old-blog1/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//suusatoshigi.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://suusatoshigi.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/主攻击技能/">主攻击技能</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/兴趣爱好/">兴趣爱好</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/总结人生/">总结人生</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/起源/">起源</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/辅助攻击技能/">辅助攻击技能</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/django/" style="font-size: 15px;">django</a> <a href="/tags/移动端测试/" style="font-size: 15px;">移动端测试</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/竞赛前复习/" style="font-size: 15px;">竞赛前复习</a> <a href="/tags/设计模式（Java）/" style="font-size: 15px;">设计模式（Java）</a> <a href="/tags/问题处理方案/" style="font-size: 15px;">问题处理方案</a> <a href="/tags/旅游游记/" style="font-size: 15px;">旅游游记</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/18/japan-travelling/">箱根－大阪－京都－奈良－六甲山－江之岛－东京11日日本自由行</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/11/python-1/">算法-花样排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/09/django-1/">django初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/last-ios-study/">最近iOS学习内容计划详情</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/27/shalong-pre/">关于11月28号SegmentFault D-DAY沙龙</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/26/reason/">为什么开始写博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/31/old-blog1/">RSA加密算法在iOS9下的问题解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/30/test-old-blog1/">app测试篇（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/16/java-old-blog2/">设计模式之适配器模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/24/java-old-blog1/">处理eclipse导入svn后的错误:找不到或无法加载主类</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//suusatoshigi.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="https://github.com/SuuSatoshigi" title="Github" target="_blank">Github</a><ul></ul><a href="http://blog.csdn.net/u010558548/article/" title="CSDN" target="_blank">CSDN</a><ul></ul><a href="http://suusatoshigi.pythonanywhere.com/personal_resume/" title="个人简历" target="_blank">个人简历</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">SuuSatoshigi's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>